@model Online_Learning_Platform_Ass1.Service.DTOs.LearningPath.UserLearningPathWithProgressDto

@{
    ViewData["Title"] = $"Progress: {Model.Title}";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="mb-4">
                <a asp-action="MyPaths" class="btn btn-outline-secondary btn-sm mb-3">
                    <i class="bi bi-arrow-left"></i> Back
                </a>
                <h1 class="display-5 mb-2">@Model.Title</h1>
                <p class="text-muted">Track your learning progress</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <!-- Progress Overview -->
            <div class="card card-modern shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-bar-chart"></i> Progress Overview</h5>
                </div>
                <div class="card-body">
                    <!-- Main Progress Bar -->
                    <div class="mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <label class="text-muted">Overall Completion</label>
                            <h5 class="mb-0">
                                <span class="badge bg-success">@Model.ProgressPercentage%</span>
                            </h5>
                        </div>
                        <div class="progress" style="height: 32px;">
                            <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                                 role="progressbar" 
                                 style="width: @(Model.ProgressPercentage)%"
                                 aria-valuenow="@Model.ProgressPercentage" 
                                 aria-valuemin="0" 
                                 aria-valuemax="100">
                                <span class="fw-bold">@Model.CompletedCourses / @Model.TotalCourses courses</span>
                            </div>
                        </div>
                    </div>

                    <!-- Status Cards -->
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-0 bg-light text-center">
                                <div class="card-body">
                                    <h4 class="text-primary mb-0">@Model.TotalCourses</h4>
                                    <small class="text-muted">Total Courses</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 bg-light text-center">
                                <div class="card-body">
                                    <h4 class="text-success mb-0">@Model.CompletedCourses</h4>
                                    <small class="text-muted">Completed</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 bg-light text-center">
                                <div class="card-body">
                                    <h4 class="text-warning mb-0">@(Model.TotalCourses - Model.CompletedCourses)</h4>
                                    <small class="text-muted">Remaining</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr />

                    <!-- Timeline -->
                    <div class="row text-center">
                        <div class="col-md-6">
                            <small class="text-muted d-block">Started</small>
                            <h6 class="mb-0">@Model.EnrolledAt.ToString("MMM dd, yyyy")</h6>
                        </div>
                        @if (Model.CompletedAt.HasValue)
                        {
                            <div class="col-md-6">
                                <small class="text-muted d-block">Completed</small>
                                <h6 class="mb-0">@Model.CompletedAt.Value.ToString("MMM dd, yyyy")</h6>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <!-- Courses in Path -->
            <div class="card card-modern shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-book"></i> Courses in this Path</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        @{
                            int courseIndex = 1;
                        }
                        @foreach (var course in Model.Courses)
                        {
                            <a href="#" class="list-group-item list-group-item-action">
                                <div class="d-flex w-100 justify-content-between align-items-center">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1">
                                            <span class="badge bg-secondary me-2">@courseIndex</span>
                                            @course.Title
                                        </h6>
                                        <small class="text-muted d-block mb-2">
                                            <i class="bi bi-person"></i> @course.InstructorName
                                        </small>
                                        <small class="text-muted">
                                            <i class="bi bi-tag"></i> @course.CategoryName
                                        </small>
                                    </div>
                                    <div class="text-end ms-2">
                                        <small class="text-muted d-block">@course.Price.ToString("C")</small>
                                        <i class="bi bi-check-circle text-success"></i>
                                    </div>
                                </div>
                            </a>
                            courseIndex++;
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Path Info Card -->
            <div class="card card-modern sticky-top shadow-sm mb-4" style="top: 20px;">
                <div class="card-header bg-gradient-primary text-white text-center">
                    <h5 class="mb-0">Path Information</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block">Path Price</small>
                        <h4 class="text-success mb-0">@Model.Price.ToString("C")</h4>
                    </div>
                    
                    <hr />

                    <div class="mb-3">
                        <small class="text-muted d-block">Status</small>
                        <span class="badge bg-success">@Model.EnrollmentStatus</span>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted d-block">Total Courses</small>
                        <h5 class="mb-0">@Model.TotalCourses</h5>
                    </div>

                    <div class="mb-3">
                        <small class="text-muted d-block">Completed</small>
                        <h5 class="mb-0">@Model.CompletedCourses / @Model.TotalCourses</h5>
                    </div>

                    <hr />

                    <div class="d-grid gap-2">
                        <a asp-controller="Course" asp-action="MyCourses" class="btn btn-primary">
                            <i class="bi bi-play-circle"></i> My Courses
                        </a>
                        <form asp-controller="LearningPath" asp-action="DropPath" method="post">
                            <input type="hidden" name="enrollmentId" value="@Model.EnrollmentId" />
                            <button type="submit" class="btn btn-outline-danger w-100"
                                    onclick="return confirm('Are you sure you want to drop this learning path?');">
                                <i class="bi bi-trash"></i> Drop Path
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
