@model Online_Learning_Platform_Ass1.Service.DTOs.Course.CourseLearnViewModel
@using Online_Learning_Platform_Ass1.Service.Enums

@{
	ViewData["Title"] = Model.Title;
}

<div id="learn-root"
	 class="row g-0"
	 data-enrollment-id="@Model.EnrollmentId">

	<!-- Left - Main Content -->
	<div class="col-md-8 border-end" style="min-height: 100vh; background: var(--gray-50);">
		<div class="p-4">
			<h3 class="fw-bold mb-4">@Model.Title</h3>

			@if (Model.CurrentLesson == null)
			{
				<div class="text-center py-5">
					<i class="bi bi-play-circle" style="font-size: 5rem; color: var(--gray-300);"></i>
					<p class="text-muted mt-4 lead">
						Ch?n m?t bài h?c ? bên ph?i d? b?t d?u.
					</p>
				</div>
			}
			else
			{
				<div class="lesson-content">

					@if (!string.IsNullOrEmpty(Model.CurrentLesson.VideoUrl))
					{
						<div class="mb-4 position-relative" style="border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-lg);">
							<video controls width="100%" style="display: block; background: #000;">
								<source src="@Model.CurrentLesson.VideoUrl" type="video/mp4" />
							</video>
						</div>
					}

					<div class="card card-modern shadow-sm mb-4">
						<div class="card-body p-4">
							<h4 class="fw-bold mb-3">@Model.CurrentLesson.Title</h4>

							<div class="lesson-text mt-3">
								@Html.Raw(Model.CurrentLesson.Content)
							</div>

							<div class="d-flex align-items-center text-muted mt-4 pt-3 border-top">
								<i class="bi bi-clock me-2"></i>
								<span>Th?i lu?ng: <strong>@Model.CurrentLesson.Duration phút</strong></span>
							</div>
						</div>
					</div>

					@if (!string.IsNullOrEmpty(Model.CurrentLesson.VideoUrl))
					{
						<!-- AI SUPPORT -->
						<div class="card card-modern shadow-sm">
							<div class="card-header" style="background: var(--gradient-primary); color: white;">
								<h6 class="mb-0">
									<i class="bi bi-robot me-2"></i>AI H? tr? bài h?c
								</h6>
							</div>
							<div class="card-body p-4">
								<button class="btn btn-modern btn-sm mb-3"
										id="btn-summary"
										data-lesson-id="@Model.CurrentLesson.Id"
										@(Model.CurrentLesson.AiSummaryStatus == AiSummaryStatus.Processing ? "disabled" : "")>
									<i class="bi bi-stars me-2"></i>Tóm t?t b?ng AI
								</button>

								<div id="ai-summary" class="mb-3">
									@if (Model.CurrentLesson.AiSummaryStatus == AiSummaryStatus.Processing)
									{
										<div class="alert alert-info-modern">
											<i class="bi bi-hourglass-split"></i>
											<div>Ð?i xíu, AI dang tóm t?t bài này...</div>
										</div>
									}
									else if (Model.CurrentLesson.AiSummaryStatus == AiSummaryStatus.Done)
									{
										<div class="alert alert-success-modern">
											@Html.Raw(Model.CurrentLesson.AiSummary)
										</div>
									}
								</div>

								<div class="divider"></div>

								<div class="input-group mt-3">
									<input type="text"
										   id="ai-question"
										   class="form-control form-control-lg"
										   placeholder="H?i AI v? video này..." />

									<button class="btn btn-gradient btn-modern"
											id="btn-ask"
											data-lesson-id="@Model.CurrentLesson.Id">
										<i class="bi bi-send-fill"></i>
									</button>
								</div>

								<div id="ai-answer" class="mt-3"></div>
							</div>
						</div>
					}
				</div>
			}
		</div>
	</div>

	<!-- Right - Sidebar / Curriculum -->
	<div class="col-md-4" style="background: white; min-height: 100vh; overflow-y: auto;">
		<div class="p-4">
			<h5 class="fw-bold mb-4">N?i dung khóa h?c</h5>

			@foreach (var module in Model.Modules)
			{
				<div class="mb-4">
					<h6 class="fw-semibold mb-3">
						<i class="bi bi-folder2-open me-2 text-primary"></i>@module.Title
					</h6>

					<div class="list-group list-group-flush">
						@foreach (var lesson in module.Lessons)
						{
							<a href="?lessonId=@lesson.Id"
							   class="list-group-item list-group-item-action d-flex align-items-center @(lesson.IsCurrent ? "active" : "")">
								<div class="flex-grow-1">
									<div class="d-flex align-items-center">
										<i class="bi bi-circle me-2 text-muted"></i>
										<span class="@(lesson.IsCurrent ? "fw-bold" : "")">@lesson.Title</span>
									</div>
									<small class="text-muted">@lesson.Duration phút</small>
								</div>
							</a>
						}
					</div>
				</div>
			}
		</div>
	</div>
</div>

@section Scripts {
	<script src="~/js/learn.js"></script>
}
